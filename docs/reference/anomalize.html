<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Detect anomalies using the tidyverse — anomalize • anomalize</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Detect anomalies using the tidyverse — anomalize" />
<meta property="og:description" content="The anomalize() function is used to detect outliers in a distribution
with no trend or seasonality present. It takes the output of time_decompose(),
which has be de-trended and applies anomaly detection methods to identify outliers." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-76139189-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-76139189-1');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">anomalize</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Function Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/anomalize_quick_start_guide.html">Anomalize Quick Start Guide</a>
    </li>
    <li>
      <a href="../articles/anomalize_methods.html">Anomalize Methods</a>
    </li>
    <li>
      <a href="../articles/forecasting_with_cleaned_anomalies.html">Reduce Forecast Error by Cleaning Anomalies</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/business-science/anomalize">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Detect anomalies using the tidyverse</h1>
    <small class="dont-index">Source: <a href='https://github.com/business-science/anomalize/blob/master/R/anomalize.R'><code>R/anomalize.R</code></a></small>
    <div class="hidden name"><code>anomalize.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The <code>anomalize()</code> function is used to detect outliers in a distribution
with no trend or seasonality present. It takes the output of <code><a href='time_decompose.html'>time_decompose()</a></code>,
which has be de-trended and applies anomaly detection methods to identify outliers.</p>
    </div>

    <pre class="usage"><span class='fu'>anomalize</span><span class='op'>(</span>
  <span class='va'>data</span>,
  <span class='va'>target</span>,
  method <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"iqr"</span>, <span class='st'>"gesd"</span><span class='op'>)</span>,
  alpha <span class='op'>=</span> <span class='fl'>0.05</span>,
  max_anoms <span class='op'>=</span> <span class='fl'>0.2</span>,
  verbose <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>A <code>tibble</code> or <code>tbl_time</code> object.</p></td>
    </tr>
    <tr>
      <th>target</th>
      <td><p>A column to apply the function to</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>The anomaly detection method. One of <code>"iqr"</code> or <code>"gesd"</code>.
The IQR method is faster at the expense of possibly not being quite as accurate.
The GESD method has the best properties for outlier detection, but is loop-based
and therefore a bit slower.</p></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>Controls the width of the "normal" range.
Lower values are more conservative while higher values are less prone
to incorrectly classifying "normal" observations.</p></td>
    </tr>
    <tr>
      <th>max_anoms</th>
      <td><p>The maximum percent of anomalies permitted to be identified.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>A boolean. If <code>TRUE</code>, will return a list containing useful information
about the anomalies. If <code>FALSE</code>, just returns the data expanded with the anomalies and
the lower (l1) and upper (l2) bounds.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns a <code>tibble</code> / <code>tbl_time</code> object or list depending on the value of <code>verbose</code>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The return has three columns:
"remainder_l1" (lower limit for anomalies), "remainder_l2" (upper limit for
anomalies), and "anomaly" (Yes/No).</p>
<p>Use <code><a href='time_decompose.html'>time_decompose()</a></code> to decompose a time series prior to performing
anomaly detection with <code>anomalize()</code>.  Typically, <code>anomalize()</code> is
performed on the "remainder" of the time series decomposition.</p>
<p>For non-time series data (data without trend), the <code>anomalize()</code> function can
be used without time series decomposition.</p>
<p>The <code>anomalize()</code> function uses two methods for outlier detection
each with benefits.</p>
<p><strong>IQR</strong>:</p>
<p>The IQR Method uses an innerquartile range of 25% and 75% to establish a baseline distribution around
the median. With the default <code>alpha = 0.05</code>, the limits are established by expanding
the 25/75 baseline by an IQR Factor of 3 (3X). The IQR Factor = 0.15 / alpha (hense 3X with alpha = 0.05).
To increase the IQR Factor controling the limits, decrease the alpha, which makes
it more difficult to be an outlier. Increase alpha to make it easier to be an outlier.</p>
<p>The IQR method is used in <a href='https://github.com/robjhyndman/forecast'><code><a href='https://pkg.robjhyndman.com/forecast/reference/tsoutliers.html'>forecast::tsoutliers()</a></code></a>.</p>
<p><strong>GESD</strong>:</p>
<p>The GESD Method (Generlized Extreme Studentized Deviate Test) progressively
eliminates outliers using a Student's T-Test comparing the test statistic to a critical value.
Each time an outlier is removed, the test statistic is updated. Once test statistic
drops below the critical value, all outliers are considered removed. Because this method
involves continuous updating via a loop, it is slower than the IQR method. However, it
tends to be the best performing method for outlier removal.</p>
<p>The GESD method is used in <a href='https://github.com/twitter/AnomalyDetection'><code>AnomalyDection::AnomalyDetectionTs()</code></a>.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    
<ol>
<li><p><a href='https://stats.stackexchange.com/questions/69874/how-to-correct-outliers-once-detected-for-time-series-data-forecasting'>How to correct outliers once detected for time series data forecasting? Cross Validated, https://stats.stackexchange.com</a></p></li>
<li><p><a href='https://stats.stackexchange.com/questions/1142/simple-algorithm-for-online-outlier-detection-of-a-generic-time-series?'>Cross Validated: Simple algorithm for online outlier detection of a generic time series. Cross Validated, https://stats.stackexchange.com</a></p></li>
<li><p><a href='https://www.usenix.org/system/files/conference/hotcloud14/hotcloud14-vallis.pdf'>Owen S. Vallis, Jordan Hochenbaum and Arun Kejariwal (2014). A Novel Technique for Long-Term Anomaly Detection in the Cloud. Twitter Inc.</a></p></li>
<li><p><a href='https://github.com/twitter/AnomalyDetection'>Owen S. Vallis, Jordan Hochenbaum and Arun Kejariwal (2014). AnomalyDetection: Anomaly Detection Using Seasonal Hybrid Extreme Studentized Deviate Test. R package version 1.0.</a></p></li>
<li><p><a href='https://www.astm.org/standardization-news/images/nd15/nd15_datapoints.pdf'>Alex T.C. Lau (November/December 2015). GESD - A Robust and Effective Technique for Dealing with Multiple Outliers. ASTM Standardization News. www.astm.org/sn</a></p></li>
</ol>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Anomaly Detection Methods (Powers <code>anomalize</code>)</p><ul>
<li><p><code><a href='anomalize_methods.html'>iqr()</a></code></p></li>
<li><p><code><a href='anomalize_methods.html'>gesd()</a></code></p></li>
</ul>

<p>Time Series Anomaly Detection Functions (anomaly detection workflow):</p><ul>
<li><p><code><a href='time_decompose.html'>time_decompose()</a></code></p></li>
<li><p><code><a href='time_recompose.html'>time_recompose()</a></code></p></li>
</ul>
</div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: ‘dplyr’</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from ‘package:stats’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    filter, lag</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from ‘package:base’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    intersect, setdiff, setequal, union</span></div><div class='input'>
<span class='co'># Needed to pass CRAN check / This is loaded by default</span>
<span class='fu'><a href='set_time_scale_template.html'>set_time_scale_template</a></span><span class='op'>(</span><span class='fu'><a href='set_time_scale_template.html'>time_scale_template</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>tidyverse_cran_downloads</span><span class='op'>)</span>

<span class='va'>tidyverse_cran_downloads</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='time_decompose.html'>time_decompose</a></span><span class='op'>(</span><span class='va'>count</span>, method <span class='op'>=</span> <span class='st'>"stl"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>anomalize</span><span class='op'>(</span><span class='va'>remainder</span>, method <span class='op'>=</span> <span class='st'>"iqr"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Registered S3 method overwritten by 'quantmod':</span>
#&gt; <span class='message'>  method            from</span>
#&gt; <span class='message'>  as.zoo.data.frame zoo </span></div><div class='output co'>#&gt; # A time tibble: 6,375 x 9
#&gt; <span style='color: #555555;'># Index:  date</span><span>
#&gt; </span><span style='color: #555555;'># Groups: package [15]</span><span>
#&gt;    package date       observed season trend remainder remainder_l1 remainder_l2
#&gt;    </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>   </span><span style='color: #555555;font-style: italic;'>&lt;date&gt;</span><span>        </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>  </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>     </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>        </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>        </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'> 1</span><span> broom   2017-01-01    </span><span style='text-decoration: underline;'>1</span><span>053. -</span><span style='color: #BB0000;text-decoration: underline;'>1</span><span style='color: #BB0000;'>007.</span><span> </span><span style='text-decoration: underline;'>1</span><span>708.    352.         -</span><span style='color: #BB0000;text-decoration: underline;'>1</span><span style='color: #BB0000;'>725.</span><span>        </span><span style='text-decoration: underline;'>1</span><span>704.
#&gt; </span><span style='color: #555555;'> 2</span><span> broom   2017-01-02    </span><span style='text-decoration: underline;'>1</span><span>481    340. </span><span style='text-decoration: underline;'>1</span><span>731.   -</span><span style='color: #BB0000;'>589.</span><span>         -</span><span style='color: #BB0000;text-decoration: underline;'>1</span><span style='color: #BB0000;'>725.</span><span>        </span><span style='text-decoration: underline;'>1</span><span>704.
#&gt; </span><span style='color: #555555;'> 3</span><span> broom   2017-01-03    </span><span style='text-decoration: underline;'>1</span><span>851    563. </span><span style='text-decoration: underline;'>1</span><span>753.   -</span><span style='color: #BB0000;'>465.</span><span>         -</span><span style='color: #BB0000;text-decoration: underline;'>1</span><span style='color: #BB0000;'>725.</span><span>        </span><span style='text-decoration: underline;'>1</span><span>704.
#&gt; </span><span style='color: #555555;'> 4</span><span> broom   2017-01-04    </span><span style='text-decoration: underline;'>1</span><span>947    526. </span><span style='text-decoration: underline;'>1</span><span>775.   -</span><span style='color: #BB0000;'>354.</span><span>         -</span><span style='color: #BB0000;text-decoration: underline;'>1</span><span style='color: #BB0000;'>725.</span><span>        </span><span style='text-decoration: underline;'>1</span><span>704.
#&gt; </span><span style='color: #555555;'> 5</span><span> broom   2017-01-05    </span><span style='text-decoration: underline;'>1</span><span>927    430. </span><span style='text-decoration: underline;'>1</span><span>798.   -</span><span style='color: #BB0000;'>301.</span><span>         -</span><span style='color: #BB0000;text-decoration: underline;'>1</span><span style='color: #BB0000;'>725.</span><span>        </span><span style='text-decoration: underline;'>1</span><span>704.
#&gt; </span><span style='color: #555555;'> 6</span><span> broom   2017-01-06    </span><span style='text-decoration: underline;'>1</span><span>948    136. </span><span style='text-decoration: underline;'>1</span><span>820.     -</span><span style='color: #BB0000;'>8.11</span><span>       -</span><span style='color: #BB0000;text-decoration: underline;'>1</span><span style='color: #BB0000;'>725.</span><span>        </span><span style='text-decoration: underline;'>1</span><span>704.
#&gt; </span><span style='color: #555555;'> 7</span><span> broom   2017-01-07    </span><span style='text-decoration: underline;'>1</span><span>542   -</span><span style='color: #BB0000;'>988.</span><span> </span><span style='text-decoration: underline;'>1</span><span>842.    688.         -</span><span style='color: #BB0000;text-decoration: underline;'>1</span><span style='color: #BB0000;'>725.</span><span>        </span><span style='text-decoration: underline;'>1</span><span>704.
#&gt; </span><span style='color: #555555;'> 8</span><span> broom   2017-01-08    </span><span style='text-decoration: underline;'>1</span><span>479. -</span><span style='color: #BB0000;text-decoration: underline;'>1</span><span style='color: #BB0000;'>007.</span><span> </span><span style='text-decoration: underline;'>1</span><span>864.    622.         -</span><span style='color: #BB0000;text-decoration: underline;'>1</span><span style='color: #BB0000;'>725.</span><span>        </span><span style='text-decoration: underline;'>1</span><span>704.
#&gt; </span><span style='color: #555555;'> 9</span><span> broom   2017-01-09    </span><span style='text-decoration: underline;'>2</span><span>057    340. </span><span style='text-decoration: underline;'>1</span><span>887.   -</span><span style='color: #BB0000;'>169.</span><span>         -</span><span style='color: #BB0000;text-decoration: underline;'>1</span><span style='color: #BB0000;'>725.</span><span>        </span><span style='text-decoration: underline;'>1</span><span>704.
#&gt; </span><span style='color: #555555;'>10</span><span> broom   2017-01-10    </span><span style='text-decoration: underline;'>2</span><span>278    563. </span><span style='text-decoration: underline;'>1</span><span>909.   -</span><span style='color: #BB0000;'>194.</span><span>         -</span><span style='color: #BB0000;text-decoration: underline;'>1</span><span style='color: #BB0000;'>725.</span><span>        </span><span style='text-decoration: underline;'>1</span><span>704.
#&gt; </span><span style='color: #555555;'># … with 6,365 more rows, and 1 more variable: anomaly </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span></div><div class='input'>

</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Matt Dancho, Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


